From 232af24a439f107a6eeb15118cac91b057b7a567 Mon Sep 17 00:00:00 2001
From: The-BB <tun.chen.bo@gmail.com>
Date: Sun, 6 Aug 2023 13:45:28 +0300
Subject: [PATCH] lang/python/python-dbus-fast: bump to 1.90.1

---
 lang/python/python-dbus-fast/Makefile         |  8 +++++---
 .../patches/500-fix-paths.patch               | 20 +++++++++++++++++++
 2 files changed, 25 insertions(+), 3 deletions(-)
 create mode 100644 lang/python/python-dbus-fast/patches/500-fix-paths.patch

diff --git a/lang/python/python-dbus-fast/Makefile b/lang/python/python-dbus-fast/Makefile
index 8579e13a4..7143ce3cf 100644
--- a/lang/python/python-dbus-fast/Makefile
+++ b/lang/python/python-dbus-fast/Makefile
@@ -4,15 +4,17 @@
 # This is free software, licensed under the GNU General Public License v2.
 # See /LICENSE for more information.
 #
+# XXX bump (hass)
+
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=python-dbus-fast
-PKG_VERSION:=1.84.2
-PKG_RELEASE:=2
+PKG_VERSION:=1.90.1
+PKG_RELEASE:=1
 
 PYPI_NAME:=dbus-fast
 PYPI_SOURCE_NAME:=dbus_fast
-PKG_HASH:=62b00b85c5835bff1d7ab5b12d494e588d92612bedbd7ca86176861729b8e4bc
+PKG_HASH:=eff98b45443681bd8876bbb1444b35112d62e8d12157f004d88ebe5f0481d5b7
 
 PKG_MAINTAINER:=Quintin Hill <stuff@quintin.me.uk>
 PKG_LICENSE:=MIT
diff --git a/lang/python/python-dbus-fast/patches/500-fix-paths.patch b/lang/python/python-dbus-fast/patches/500-fix-paths.patch
new file mode 100644
index 000000000..cf75c900f
--- /dev/null
+++ b/lang/python/python-dbus-fast/patches/500-fix-paths.patch
@@ -0,0 +1,20 @@
+--- a/src/dbus_fast/_private/address.py
++++ b/src/dbus_fast/_private/address.py
+@@ -42,7 +42,7 @@ def get_system_bus_address():
+     if "DBUS_SYSTEM_BUS_ADDRESS" in os.environ:
+         return os.environ["DBUS_SYSTEM_BUS_ADDRESS"]
+     else:
+-        return "unix:path=/var/run/dbus/system_bus_socket"
++        return "unix:path=/opt/var/run/dbus/system_bus_socket"
+ 
+ 
+ display_re = re.compile(r".*:([0-9]+)\.?.*")
+@@ -71,7 +71,7 @@ def get_session_bus_address():
+     # should be fairly reliable. fix this by passing in an async func to read
+     # the file for each io backend.
+     machine_id = None
+-    with open("/var/lib/dbus/machine-id") as f:
++    with open("/opt/var/lib/dbus/machine-id") as f:
+         machine_id = f.read().rstrip()
+ 
+     dbus_info_file_name = f"{home}/.dbus/session-bus/{machine_id}-{display}"
-- 
2.30.2

