From e987f6031f11228622c4a863c8ae1f172168f291 Mon Sep 17 00:00:00 2001
From: The-BB <tun.chen.bo@gmail.com>
Date: Fri, 27 Oct 2023 12:47:30 +0300
Subject: [PATCH] lang/python/python-yaml: bump to 6.0.1

---
 lang/python/python-yaml/Makefile              |  7 +++---
 .../patches/500-fix-cython-3x.patch           | 23 +++++++++++++++++++
 2 files changed, 27 insertions(+), 3 deletions(-)
 create mode 100644 lang/python/python-yaml/patches/500-fix-cython-3x.patch

diff --git a/lang/python/python-yaml/Makefile b/lang/python/python-yaml/Makefile
index 57b8d99e7..25ee4d6b8 100644
--- a/lang/python/python-yaml/Makefile
+++ b/lang/python/python-yaml/Makefile
@@ -5,15 +5,16 @@
 # See /LICENSE for more information.
 #
 # XXX Entware specific: added host build
+# XXX bump (hass)
 
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=python-yaml
-PKG_VERSION:=6.0
-PKG_RELEASE:=4
+PKG_VERSION:=6.0.1
+PKG_RELEASE:=1a
 
 PYPI_NAME:=PyYAML
-PKG_HASH:=68fb519c14306fec9720a2a5b45bc9f0c8d1b9c72adf45c37baedfcd949c35a2
+PKG_HASH:=bfdf460b1736c775f2ba9f6a92bca30bc2095067b8a9d77876d1fad6cc3b4a43
 
 PKG_MAINTAINER:=Josef Schlehofer <josef.schlehofer@nic.cz>
 PKG_LICENSE:=MIT
diff --git a/lang/python/python-yaml/patches/500-fix-cython-3x.patch b/lang/python/python-yaml/patches/500-fix-cython-3x.patch
new file mode 100644
index 000000000..68c4f17d3
--- /dev/null
+++ b/lang/python/python-yaml/patches/500-fix-cython-3x.patch
@@ -0,0 +1,23 @@
+--- a/pyproject.toml
++++ b/pyproject.toml
+@@ -1,3 +1,3 @@
+ [build-system]
+-requires = ["setuptools", "wheel", "Cython<3.0"]
++requires = ["setuptools", "wheel", "Cython"]
+ build-backend = "setuptools.build_meta"
+--- a/setup.py
++++ b/setup.py
+@@ -81,8 +81,11 @@ if 'sdist' in sys.argv or os.environ.get
+     # we need cython here
+     with_cython = True
+ try:
+-    from Cython.Distutils.extension import Extension as _Extension
+-    from Cython.Distutils import build_ext as _build_ext
++    try:
++        from Cython.Distutils.old_build_ext import old_build_ext as _build_ext
++    except ImportError:
++        from Cython.Distutils import build_ext as _build_ext
++
+     with_cython = True
+ except ImportError:
+     if with_cython:
-- 
2.30.2

